<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>File: QuickStart</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: QuickStart</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'><h1 id='quickstart_guide'>Quickstart Guide</h1>

<h2 id='quickstart_index'>Quickstart Index</h2>

<ul>
<li><a href='#where_to_download'>Where to download?</a></li>

<li><a href='#installation'>Installation</a></li>

<li><a href='#configuration'>Configuration</a><br /> - <a href='#emerge'>Emerge</a></li>

<li><a href='#usage'>Usage</a></li>

<li><a href='#commands'>Commands</a><br /> - <a href='#setup'>setup</a><br /> - <a href='#build'>build</a><br /> - <a href='#target'>target</a><br /> - <a href='#rescue'>rescue</a><br /> - <a href='#resume'>resume</a> <br /> - <a href='#freshen'>freshen</a><br /> - <a href='#clean'>clean</a></li>

<li><a href='#shell'>shell</a></li>

<li><a href='#notes'>Notes</a></li>
</ul>

<h2 id='where_to_download'>Where to download?</h2>

<p>The best way to get Athenry is to check out the latest release branch from github.</p>

<pre class="code">$ <span class='git identifier id'>git</span> <span class='clone identifier id'>clone</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='gregf identifier id'>gregf</span><span class='div op'>/</span><span class='athenry identifier id'>athenry</span><span class='dot token'>.</span><span class='git identifier id'>git</span> <span class='athenry identifier id'>athenry</span>
</pre>

<h2 id='installation'>Installation</h2>

<p>After checking out a fresh copy of Athenry from git or extracting a previously downloaded tarball, Athenry needs to be installed. To install Athenry run install.rb.</p>

<pre class="code">$ <span class='cd identifier id'>cd</span> <span class='athenry identifier id'>athenry</span>
$ <span class='dot token'>.</span><span class='div op'>/</span><span class='install identifier id'>install</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>

<h2 id='configuration'>Configuration</h2>

<p>Athenry stores all configuration data in a plain text config file. During Athenry&#8217;s first installation, athenry.conf is copied to /etc/athenry/athenry.conf. The default configuration options provided in /etc/athenry/athenry.conf are sane defaults that the developers chose. These settings should work for most anyone that would like to give Athenry a try.</p>

<p>With that said, it is a good idea to review the config file to see if there are configuration options that may work better for you such as the working directory, your timezone, and even what mirrors to use. As the athenry.conf in /etc are settings the developers consider sane defaults, it is highly recommend that athenry.conf be copied to ~/.config/athenry/athenry.conf. Athenry actually checks for ~/.config/athenry/athenry.conf for it&#8217;s configuration settings before looking in /etc/athenry/athenry.conf. All changes to Athenry&#8217;s configuration and settings should be made to this local configuration file. That way /etc/athenry/athenry.conf will always be there for reference in case you make a change and Athenry no longer does what is expected. Another detail to keep in mind is every time Athenry is updated, /etc/athenry/athenry.conf is overwritten with any new configuration options, deprecated options are removed, any changes that the developers may think are better defaults now will be updated. To put it simply, any personal changes made to the config in /etc will be overwritten with Athenry&#8217;s updated config.</p>

<p>The developers recommend that you update Athenry regularly, then diff the local Athenry config file in ~/ to the Athenry config in /etc. Think of this as a &#8220;manual&#8221; etc-update. This is an easy way to see what new features Athenry has, any changes in how Athenry works, and any options or functions that have been deprecated and/or removed</p>

<p>The following is the list of Athenry&#8217;s currently sane defaults and available settings.</p>

<h3 id='athenryconf'>athenry.conf:</h3>

<pre class="code"><span class='lbrack token'>[</span><span class='general identifier id'>general</span><span class='rbrack token'>]</span>
<span class='workdir identifier id'>workdir</span> <span class='assign token'>=</span> <span class='regexp val'>/var/</span><span class='tmp identifier id'>tmp</span><span class='div op'>/</span><span class='athenry identifier id'>athenry</span>
<span class='timezone identifier id'>timezone</span> <span class='assign token'>=</span> <span class='EST5EDT constant id'>EST5EDT</span>
<span class='verbose identifier id'>verbose</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
<span class='arch identifier id'>arch</span> <span class='assign token'>=</span> <span class='amd64 identifier id'>amd64</span>
 
<span class='lbrack token'>[</span><span class='stage identifier id'>stage</span><span class='rbrack token'>]</span>
<span class='url identifier id'>url</span> <span class='assign token'>=</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gentoo.osuosl.org/</span><span class='releases identifier id'>releases</span><span class='div op'>/</span><span class='amd64 identifier id'>amd64</span><span class='div op'>/</span><span class='current identifier id'>current</span><span class='minus op'>-</span><span class='stage3 identifier id'>stage3</span><span class='div op'>/</span><span class='stage3 identifier id'>stage3</span><span class='minus op'>-</span><span class='amd64 identifier id'>amd64</span><span class='minus op'>-</span><span class='float val'>20100121</span><span class='dot token'>.</span><span class='tar identifier id'>tar</span><span class='dot token'>.</span><span class='bz2 identifier id'>bz2</span>
 
<span class='lbrack token'>[</span><span class='snapshot identifier id'>snapshot</span><span class='rbrack token'>]</span>
<span class='url identifier id'>url</span> <span class='assign token'>=</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gentoo.osuosl.org/s</span><span class='napshots identifier id'>napshots</span><span class='div op'>/</span><span class='portage identifier id'>portage</span><span class='minus op'>-</span><span class='latest identifier id'>latest</span><span class='dot token'>.</span><span class='tar identifier id'>tar</span><span class='dot token'>.</span><span class='bz2 identifier id'>bz2</span>
 
<span class='lbrack token'>[</span><span class='overlays identifier id'>overlays</span><span class='rbrack token'>]</span>
<span class='sunrise identifier id'>sunrise</span> <span class='assign token'>=</span>
<span class='mpd identifier id'>mpd</span> <span class='assign token'>=</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='gregf identifier id'>gregf</span><span class='div op'>/</span><span class='mpd identifier id'>mpd</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
 
<span class='lbrack token'>[</span><span class='gentoo identifier id'>gentoo</span><span class='rbrack token'>]</span>
<span class='sync identifier id'>sync</span> <span class='assign token'>=</span> <span class='rsync identifier id'>rsync</span><span class='symbol val'>:/</span><span class='regexp val'>/rsync.gentoo.org/</span><span class='gentoo identifier id'>gentoo</span><span class='minus op'>-</span><span class='portage identifier id'>portage</span>
<span class='sets identifier id'>sets</span> <span class='assign token'>=</span> <span class='stage4 identifier id'>stage4</span> <span class='stage5 identifier id'>stage5</span>
<span class='package identifier id'>package</span>\<span class='_manager identifier id'>_manager</span> <span class='assign token'>=</span> <span class='paludis identifier id'>paludis</span>
<span class='profile identifier id'>profile</span> <span class='assign token'>=</span> <span class='default identifier id'>default</span><span class='div op'>/</span><span class='linux identifier id'>linux</span><span class='div op'>/</span><span class='amd64 identifier id'>amd64</span><span class='div op'>/</span><span class='float val'>10.0</span>
</pre>

<dl>
<dt><strong>workdir</strong></dt>

<dd>This is the root directory where created stages, logs, the state file, and downloaded files will be stored.</dd>

<dt><strong>timezone</strong></dt>

<dd>Timezone to be set for the chroot.</dd>

<dt><strong>verbose</strong></dt>

<dd>Does just what it implies, toggles verbosity. Even with this set to false you can tail the log file to see Athenry&#8217;s progress.</dd>

<dt><strong>arch</strong></dt>

<dd>This is the architecture you plan on building for.</dd>

<dt><strong>stageurl</strong></dt>

<dd>This is the url where Athenry will grab the stage seed from.</dd>

<dt><strong>snapshoturl</strong></dt>

<dd>This is the url where Athenry will grab the portage snapshot from.</dd>

<dt><strong>overlays</strong></dt>

<dd>This takes a list of overlays you would like to use. You can optionally specify an additional overlay url to be pulled in.</dd>

<dt><strong>sync</strong></dt>

<dd>Sets the default rsync mirror for the portage tree.</dd>

<dt><strong>sets</strong></dt>

<dd>A listing of set files to install. This is how packages to be installed into the chroot are handled.</dd>

<dt><strong>package_manager</strong></dt>

<dd>This can be set to either paludis or emerge.</dd>

<dt><strong>profile</strong></dt>

<dd>Default gentoo profile to use, this does not override configuration settings you may have set, this is only to assure the make.profile symlink is set correctly.</dd>
</dl>

<h3 id='emerge'>Emerge</h3>

<p>The current stable version of emerge does not support sets. In order to build custom stages with Athenry using emerge, versions &gt;=2.2 will have to be unmasked.</p>

<p>This is a trival task. All that needs to be done is to add the following line to package.unmask in the chroot that Athenry is using.</p>

<h3 id='packageunmask'>package.unmask</h3>

<pre class="code"><span class='geq op'>&gt;=</span><span class='sys identifier id'>sys</span><span class='minus op'>-</span><span class='apps identifier id'>apps</span><span class='div op'>/</span><span class='portage identifier id'>portage</span><span class='minus op'>-</span><span class='float val'>2.2_</span><span class='rc33 identifier id'>rc33</span>
</pre>

<p>The following documentation describes how to use sets in emerge;</p>

<ol>
<li><a href='http://dev.gentoo.org/~zmedico/portage/doc/ch02s03.html'>Portage Manual</a></li>

<li><a href='http://forums.gentoo.org/viewtopic-t-706642.html'>Help writing /etc/portage/sets.conf</a></li>

<li><a href='http://forums.gentoo.org/viewtopic-p-5127806.html'>Portage 2.2, the new features</a></li>

<li><a href='http://www.linux-archive.org/gentoo-user/250682-portage-sets.html'>Gentoo-User Discussion</a></li>

<li><a href='http://github.com/gregf/athenryconfigs/blob/master/etc/amd64/portage/sets/stage4'>Example Set File</a></li>
</ol>

<h2 id='usage'>Usage</h2>

<p>NAME:</p>

<pre class="code"><span class='Athenry constant id'>Athenry</span>
</pre>

<p>DESCRIPTION:</p>

<pre class="code"><span class='Creates constant id'>Creates</span> <span class='a identifier id'>a</span> <span class='Gentoo constant id'>Gentoo</span> <span class='chroot identifier id'>chroot</span> <span class='and and kw'>and</span> <span class='automates identifier id'>automates</span> <span class='stage identifier id'>stage</span> <span class='building identifier id'>building</span>
</pre>

<p>COMMANDS:</p>

<pre class="code"><span class='build identifier id'>build</span>                <span class='Executes constant id'>Executes</span> <span class='a identifier id'>a</span> <span class='single identifier id'>single</span> <span class='command identifier id'>command</span> <span class='on identifier id'>on</span> <span class='the identifier id'>the</span> <span class='given identifier id'>given</span> <span class='chroot identifier id'>chroot</span> <span class='lbrack token'>[</span><span class='command identifier id'>command</span><span class='rbrack token'>]</span>
<span class='clean identifier id'>clean</span>                <span class='Cleans constant id'>Cleans</span> <span class='up identifier id'>up</span> <span class='any identifier id'>any</span> <span class='mess identifier id'>mess</span> <span class='made identifier id'>made</span> <span class='lbrack token'>[</span><span class='options identifier id'>options</span><span class='rbrack token'>]</span>
<span class='freshen identifier id'>freshen</span>              <span class='Updates constant id'>Updates</span> <span class='an identifier id'>an</span> <span class='existing identifier id'>existing</span> <span class='chroot identifier id'>chroot</span>
<span class='help identifier id'>help</span>                 <span class='Display constant id'>Display</span> <span class='global identifier id'>global</span> <span class='or or kw'>or</span> <span class='lbrack token'>[</span><span class='command identifier id'>command</span><span class='rbrack token'>]</span> <span class='help identifier id'>help</span> <span class='documentation identifier id'>documentation</span><span class='dot token'>.</span>
<span class='rescue identifier id'>rescue</span>               <span class='Chroot constant id'>Chroot</span> <span class='into identifier id'>into</span> <span class='the identifier id'>the</span> <span class='current identifier id'>current</span> <span class='stage identifier id'>stage</span> <span class='to identifier id'>to</span> <span class='perform identifier id'>perform</span> <span class='commands identifier id'>commands</span> <span class='manually identifier id'>manually</span>
<span class='resume identifier id'>resume</span>               <span class='Resume constant id'>Resume</span> <span class='from identifier id'>from</span> <span class='last identifier id'>last</span> <span class='saved identifier id'>saved</span> <span class='state identifier id'>state</span>
<span class='setup identifier id'>setup</span>                <span class='Fetches constant id'>Fetches</span> <span class='files identifier id'>files</span> <span class='and and kw'>and</span> <span class='creates identifier id'>creates</span> <span class='necessary identifier id'>necessary</span> <span class='directories identifier id'>directories</span>
<span class='shell identifier id'>shell</span>                <span class='Run constant id'>Run</span> <span class='Athenry constant id'>Athenry</span> <span class='commands identifier id'>commands</span> <span class='directly identifier id'>directly</span> <span class='through identifier id'>through</span> <span class='an identifier id'>an</span> <span class='irb identifier id'>irb</span> <span class='like identifier id'>like</span> <span class='shell identifier id'>shell</span>
<span class='target identifier id'>target</span>               <span class='Starts constant id'>Starts</span> <span class='building identifier id'>building</span> <span class='the identifier id'>the</span> <span class='target identifier id'>target</span> <span class='stage identifier id'>stage</span> <span class='specified identifier id'>specified</span>
</pre>

<p>GLOBAL OPTIONS:</p>

<pre class="code"><span class='minus op'>-</span><span class='h identifier id'>h</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='help identifier id'>help</span>
    <span class='Display constant id'>Display</span> <span class='help identifier id'>help</span> <span class='documentation identifier id'>documentation</span>

<span class='minus op'>-</span><span class='v identifier id'>v</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='version identifier id'>version</span>
    <span class='Display constant id'>Display</span> <span class='version identifier id'>version</span> <span class='information identifier id'>information</span>

<span class='minus op'>-</span><span class='t identifier id'>t</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='trace identifier id'>trace</span>
    <span class='Display constant id'>Display</span> <span class='backtrace identifier id'>backtrace</span> <span class='when when kw'>when</span> <span class='an identifier id'>an</span> <span class='error identifier id'>error</span> <span class='occurs identifier id'>occurs</span>
</pre>

<p>AUTHOR:</p>

<pre class="code"><span class='Greg constant id'>Greg</span> <span class='Fitzgerald constant id'>Fitzgerald</span> <span class='lt op'>&lt;</span><span class='netzdamon identifier id'>netzdamon</span><span class='@gmail ivar id'>@gmail</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='gt op'>&gt;</span>
</pre>

<h2 id='commands'>Commands</h2>

<h3 id='setup'>setup:</h3>
<hr />
<p>The setup command does a number of things. It fetches the stage file and a portage snapshot. It checks the md5sums of those files, and extracts them. Creating the necessary directory structure for Athenry to properly operate.</p>

<p>Athenry automatically runs the setup process when any stage is built. Alternatively you can run the <code>target setup</code> command to do just the setup process. You can also run individual setup commands if you wish. For example:</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='setup identifier id'>setup</span> <span class='fetchstage identifier id'>fetchstage</span>
</pre>

<dl>
<dt><strong>fetchstage</strong></dt>

<dd>Fetches the stage from the stage url.</dd>

<dt><strong>extractstage</strong></dt>

<dd>Extracts the stage tarball into your chroot while checking the md5sum.</dd>

<dt><strong>fetchsnapshot</strong></dt>

<dd>Fetches the snapshot tarball.</dd>

<dt><strong>extractsnapshot</strong></dt>

<dd>Extracts the snapshot tarball while checking the md5sum.</dd>

<dt><strong>updatesnapshot</strong></dt>

<dd>If the snapshot cache has not been updated within 24 hours update it again using rsync.</dd>

<dt><strong>copysnapshot</strong></dt>

<dd>Copies the snapshot cache into your chrootdir.</dd>

<dt><strong>copy_scripts</strong></dt>

<dd>Copies the scripts needed to build your stage into your chroot.</dd>

<dt><strong>copy_configs</strong></dt>

<dd>Copies user defined configuration files into your chroot for use.</dd>
</dl>

<h3 id='build'>build:</h3>
<hr />
<p>The build command is used for issuing single commands to the build process. For example:</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='build identifier id'>build</span> <span class='install_pkgmgr identifier id'>install_pkgmgr</span>
</pre>

<p>All commands run from build are performed inside the specified chroot. Here is a list of commands that can be run.</p>

<dl>
<dt><strong>sync</strong></dt>

<dd>Syncs the portage tree.</dd>

<dt><strong>install_pkgmgr</strong></dt>

<dd>Installs the package manager that has been set.</dd>

<dt><strong>update_everything</strong></dt>

<dd>Updates all packages in the specified chroot.</dd>

<dt><strong>etc_update</strong></dt>

<dd>Updates any out of date configuration files in the specified chroot.</dd>

<dt><strong>install_overlays</strong></dt>

<dd>Installs overlays that have been specified in athenry.conf</dd>

<dt><strong>install_sets</strong></dt>

<dd>Installs sets that have been specified in athenry.conf</dd>

<dt><strong>rebuild</strong></dt>

<dd>Rebuilds packages with broken linkage, also runs python-updater.</dd>
</dl>

<h3 id='target'>target:</h3>
<hr />
<p>The target command is used to build an entire stage tarball in one swoop. It runs setup if it has not already been run. It will then go through all the necessary build steps in the correct order to build the specified stage.</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='target identifier id'>target</span> <span class='stage3 identifier id'>stage3</span>
</pre>

<dl>
<dt><strong>setup</strong></dt>

<dd>Runs commands necessary for initial setup.</dd>

<dt><strong>stage3</strong></dt>

<dd>Builds a stage3.</dd>

<dt><strong>custom</strong></dt>

<dd>Builds a custom stage using sets and overlays.</dd>
</dl>

<p>Currently stage3 and custom are the only stages supported. For now, the custom target must be used if any sets or custom overlays are to be installed.</p>

<h3 id='rescue'>rescue:</h3>
<hr />
<p>Rescue is for when something goes wrong, and it will. Athenry tries to build the specified stage in a way that won&#8217;t cause headaches. With that said, there are always problems that can occur. Since building a stage1 is currently not supported, the rescue command is offered. This command simply chroots into the specified chroot dir and allows any blockages or other issues that may have happened to be fixed. Athenry can then resume from where the problem occured.</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='rescue rescue kw'>rescue</span>
</pre>

<h3 id='resume'>resume:</h3>
<hr />
<p>The resume command should pick up where Athenry left off. Resuming can only be done from a target command.</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='resume identifier id'>resume</span>
</pre>

<h3 id='freshen'>freshen:</h3>
<hr />
<p>Freshen will update the specified chroot.</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='freshen identifier id'>freshen</span> 
</pre>

<h3 id='clean'>clean:</h3>
<hr />
<p>The clean command currently only performs an unmount of /dev, /proc, and /sys. It is fairly useless in it&#8217;s current state.</p>

<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='clean identifier id'>clean</span>
</pre>

<h3 id='shell'>shell:</h3>
<hr />
<pre class="code">$ <span class='athenry identifier id'>athenry</span> <span class='shell identifier id'>shell</span>
</pre>

<p>The shell command is one of Athenry&#8217;s most powerful features. This will allow you to run each step of building a stage from an irb like shell. This makes going back and copying newer configs or debugging an issue painless. Commands are tab completed using ruby readline.</p>

<h2 id='notes'>Notes</h2>

<p>Please refer to <a href='http://gregf.github.com/athenry/about/'>about</a> for more information on Athenry. Athenry is still in the very early stages of development and should not be relied upon for production use.</p></div></div>
    
    <div id="footer">
  Generated on Sat Feb  6 22:29:04 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.3 (ruby-1.8.7).
</div>

  </body>
</html>