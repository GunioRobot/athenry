#compdef athenry 

_athenry_command() {
  local athenry_cmds

    athenry_cmds=(
        setup:"Executes a single setup based command"
        build:"Executes a single command on the given chroot"
        target:"Builds a specific target"
        resume:"Resume from last saved state"
        rescue:"Chroot into the current stage to perform commands manually"
        shell:"Run Athenry commands directly through an irb like shell"
        clean:"Cleans up any mess made"
        info:"Displays information about athenry and the build process"
        help:"Display global or [command] help documentation"
    )

    if (( CURRENT == 1 )); then
        _describe -t command "athenry commands" athenry_cmds
    else
        local curcontext="$curcontext"
    fi

    local cmd=$words[1]

    local curcontext="${curcontext%:*}:athenry-${cmd}"
    _call_function ret _athenry_$cmd

}

_athenry_target() {
  local expl target_cmds
  target_cmds=(setup stage3 custom freshen)
  _wanted target_cmds expl target compadd $expl -a target_cmds
}

_athenry_build() {
  local expl build_cmds
  build_cmds=(sync install_pkgmgr update_everything etc_update install_overlays install_sets rebuild)
  _wanted build_cmds expl build compadd $expl -a build_cmds
}

_athenry_setup() {
  local expl setup_cmds
  setup_cmds=(fetchstage extractstage fetchsnapshot extractsnapshot updatesnapshot copysnapshot copy_scripts copy_configs) 
  _wanted setup_cmds expl setup compadd $expl -a setup_cmds
}

_athenry_clean() {
  local expl clean_cmds
  clean_cmds=(unmount tmp destroy)
  _wanted clean_cmds expl clean compadd $expl -a clean_cmds
}

_athenry_help() {
  local expl help_cmds
  help_cmds=(setup build target resume rescue shell clean help)
  _wanted help_cmds expl help compadd $expl -a help_cmds
}

_athenry_info() {
    local expl info_cmds
    info_cmds=(env builds chroots sync errors)
    _wanted info_cmds expl info compadd $expl -a info_cmds
}

_chroots() {
    local expl chroots
    chroots=(`athenry info chroots`)
    _wanted chroots expl chroots compadd $expl -a chroots
}

_arguments -C -s\
  '(-c --chroot)'{-c,--chroot}'[set chroot name]:file:_chroots'\
  '(-s --stageurl)'{-s,--stageurl}'[set stage url]' \
  '(-p --snapshoturl)'{-p,--snapshoturl}'[set snapshot url]' \
  '(-v --version)'{-v,--version}'[display version]' \
  '(-h --help)'{-h,--help}'[display help]' \
  '(-t --trace)'{-t,--trace}'[trace]' \
  '*::athenry command:_athenry_command'
